---
title: API Reference
description: HTTP API endpoints for the worker service.
---

# API Reference

The worker service exposes HTTP endpoints for indexing and retrieving documentation.

## Base URL

```text title="Base URL"
http://127.0.0.1:7432
```

---

## Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| `POST` | `/index` | Index a documentation site |
| `POST` | `/retrieve` | Search for relevant snippets |
| `GET` | `/status` | Get indexing status |
| `DELETE` | `/docset/:id` | Delete a docset |
| `GET` | `/health` | Health check |

---

## POST /index

Index a documentation website.

### Request

```json title="Request Body"
{
  "baseUrl": "https://nextjs.org",
  "seedSlug": "/docs/getting-started",
  "name": "Next.js Docs",
  "waitForSeed": true
}
```

### Parameters

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `baseUrl` | string | Yes | Base URL of the documentation site |
| `seedSlug` | string | Yes | Starting path to begin crawling |
| `name` | string | No | Custom name for the docset |
| `waitForSeed` | boolean | No | Wait for seed page to be indexed before returning |

### Response

```json title="Response"
{
  "docsetId": "abc123",
  "status": "indexing",
  "seedPageIndexed": true,
  "message": "Indexing started. Background crawling in progress."
}
```

### Example

```bash title="Terminal"
curl -X POST http://localhost:7432/index \
  -H "Content-Type: application/json" \
  -d '{
    "baseUrl": "https://nextjs.org",
    "seedSlug": "/docs/getting-started",
    "name": "Next.js Docs",
    "waitForSeed": true
  }'
```

---

## POST /retrieve

Search for relevant documentation snippets with diversity filtering and character budget control.

### Request

```json title="Request Body"
{
  "query": "how to use server components",
  "topK": 5,
  "docsetIds": ["abc123"],
  "maxChunksPerPage": 2,
  "maxTotalChars": 16000,
  "formatSnippets": true
}
```

### Parameters

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `query` | string | Yes | - | Search query |
| `topK` | number | No | `5` | Number of results (clamped 1-100) |
| `docsetIds` | string[] | No | All | Filter by specific docsets |
| `maxChunksPerPage` | number | No | `3` | Max chunks from same page (diversity) |
| `maxTotalChars` | number | No | `32000` | Total character budget for results |
| `formatSnippets` | boolean | No | `true` | Include formatted snippets |

### Response

```json title="Response"
{
  "query": "how to use server components",
  "results": [
    {
      "chunkId": "chunk-123",
      "pageId": "page-456",
      "docsetId": "abc123",
      "content": "Server Components allow you to write UI that can be rendered...",
      "url": "https://nextjs.org/docs/app/building-your-application/rendering/server-components",
      "title": "Server Components",
      "heading": "Introduction",
      "score": 0.89,
      "snippet": {
        "formatted": "## Server Components\nSource: https://nextjs.org/docs/.../server-components\nSection: Rendering > Server Components > Introduction\n\nServer Components allow you to write UI that can be rendered...",
        "title": "Server Components",
        "url": "https://nextjs.org/docs/app/building-your-application/rendering/server-components",
        "breadcrumb": "Rendering > Server Components > Introduction",
        "content": "Server Components allow you to write UI that can be rendered...",
        "charCount": 245
      }
    }
  ],
  "totalChars": 1250,
  "truncated": false
}
```

### Response Fields

| Field | Type | Description |
|-------|------|-------------|
| `results` | array | Array of search results with optional snippets |
| `totalChars` | number | Total characters across all results |
| `truncated` | boolean | Whether results were truncated due to budget |

### Snippet Object

When `formatSnippets` is enabled, each result includes a `snippet` object:

| Field | Type | Description |
|-------|------|-------------|
| `formatted` | string | Ready-to-use formatted text for context injection |
| `title` | string | Page title |
| `url` | string | Source URL |
| `breadcrumb` | string | Heading path (e.g., "Api > Auth > OAuth") |
| `content` | string | The content text (may be truncated) |
| `charCount` | number | Character count of formatted snippet |

### Example

```bash title="Terminal"
curl -X POST http://localhost:7432/retrieve \
  -H "Content-Type: application/json" \
  -d '{
    "query": "how to use server components",
    "topK": 5,
    "maxChunksPerPage": 2,
    "maxTotalChars": 16000,
    "formatSnippets": true
  }'
```

### Diversity Filtering

The `maxChunksPerPage` parameter prevents results from being dominated by chunks from a single page:

```bash title="Diverse Results"
# Get at most 2 chunks from each page
curl -X POST http://localhost:7432/retrieve \
  -H "Content-Type: application/json" \
  -d '{
    "query": "authentication",
    "topK": 10,
    "maxChunksPerPage": 2
  }'
```

### Character Budget

Control the total size of returned content for predictable context injection:

```bash title="Limited Budget"
# Limit total response to ~8000 characters
curl -X POST http://localhost:7432/retrieve \
  -H "Content-Type: application/json" \
  -d '{
    "query": "getting started",
    "topK": 10,
    "maxTotalChars": 8000
  }'
```

---

## GET /status

Get the status of all indexed documentation.

### Response

```json title="Response"
{
  "docsets": [
    {
      "id": "abc123",
      "name": "Next.js Docs",
      "baseUrl": "https://nextjs.org",
      "status": "complete",
      "pages": {
        "indexed": 245,
        "pending": 0,
        "failed": 2
      },
      "lastUpdated": "2024-01-15T10:30:00Z",
      "createdAt": "2024-01-15T09:00:00Z"
    }
  ],
  "totalDocsets": 1,
  "totalPages": 245
}
```

### Example

```bash title="Terminal"
curl http://localhost:7432/status
```

---

## DELETE /docset/:id

Delete a docset and all its indexed content.

### Parameters

| Parameter | Type | Description |
|-----------|------|-------------|
| `id` | string | The docset ID to delete |

### Response

```json title="Response"
{
  "success": true,
  "message": "Docset deleted successfully",
  "deletedPages": 245
}
```

### Example

```bash title="Terminal"
curl -X DELETE http://localhost:7432/docset/abc123
```

---

## GET /health

Health check endpoint.

### Response

```json title="Response"
{
  "status": "ok",
  "uptime": 3600,
  "version": "1.0.0"
}
```

### Example

```bash title="Terminal"
curl http://localhost:7432/health
```

---

## Error Responses

All endpoints return errors in this format:

```json title="Error Response"
{
  "error": "Error message here",
  "code": "ERROR_CODE",
  "details": {}
}
```

### Common Error Codes

| Code | HTTP Status | Description |
|------|-------------|-------------|
| `INVALID_REQUEST` | 400 | Invalid request parameters |
| `NOT_FOUND` | 404 | Resource not found |
| `ALREADY_EXISTS` | 409 | Docset already being indexed |
| `INTERNAL_ERROR` | 500 | Internal server error |
